<div class="analysis-container">

    <div *ngIf="analysis.getReady() !== 0" class="spinner">
        <mat-spinner color="accent" [diameter]="30"></mat-spinner>
    </div>

    <div *ngIf="analysis.getReady() === 0" class="card-container">

        <mat-card>

            <mat-card-header>

                <mat-card-title class="p-0 m-0">
                    Participants
                </mat-card-title>

            </mat-card-header>

            <hr class="my-1 mt-2" />

            <mat-card-content>
                <mat-grid-list cols="8" rowHeight="3:1" gutterSize="2px">

                    <mat-grid-tile *ngFor="let player of ss.fightPlayerMap.get(fightId)" [ngClass]="{'active mat-elevation-z6': player.id === activePlayer.id}"
                        (click)="activePlayer = player">

                        <mat-icon [svgIcon]="jobs[player.type]"></mat-icon>

                    </mat-grid-tile>

                </mat-grid-list>

                <div class="player-info-container mt-4">

                    <p>{{activePlayer.name}}</p>
                    <p>{{analysis.playerStatMap.get(activePlayer.id).hp}}</p>

                </div>

                <hr class="my-1 mt-2">

                <div class="content-display row" *ngIf="analysis.mitigationTableMap.get(activePlayer.id) !== undefined">

                    <div class="ability-container col" *ngIf="(availableMitigation[jobs[activePlayer.type]] | abilityFilter: 'a').length !== 0">

                        <div class="raidwide-container">

                            <p class="mb-2 mt-3">Raidwide Mitigation</p>

                            <div class="icon-container">

                                <div *ngFor="let key of availableMitigation[jobs[activePlayer.type]] | abilityFilter: 'a'" class="ability-icon-container">

                                    <span [matTooltip]="abilities[key.toLowerCase()].desc" [matTooltipClass]="'ability-tooltip'">

                                        <img [src]="getIcon(abilities[key.toLowerCase()].path)" class="ability-icon mat-elevation-z6"
                                            [ngClass]="{'ability-unused': analysis.mitigationTableMap.get(activePlayer.id).get(key.toLowerCase()) === undefined,
                                            'ability-active': activeSkillMap.get(activePlayer.id) === key.toLowerCase()}"
                                            (click)="activeSkillMap.set(activePlayer.id, key.toLowerCase())">

                                    </span>

                                </div>

                            </div>

                        </div>

                        <div class="personal-container" *ngIf="(availableMitigation[jobs[activePlayer.type]] | abilityFilter: 'b').length !== 0">

                            <p class="mb-2 mt-3">Single Target Mitigation</p>

                            <div class="icon-container">

                                <div *ngFor="let key of availableMitigation[jobs[activePlayer.type]] | abilityFilter: 'b'" class="ability-icon-container">

                                    <span [matTooltip]="abilities[key.toLowerCase()].desc" [matTooltipClass]="'ability-tooltip'">

                                        <img [src]="getIcon(abilities[key.toLowerCase()].path)" class="ability-icon mat-elevation-z6"
                                            [ngClass]="{'ability-unused': analysis.mitigationTableMap.get(activePlayer.id).get(key.toLowerCase()) === undefined,
                                            'ability-active': activeSkillMap.get(activePlayer.id) === key.toLowerCase()}"
                                            (click)="activeSkillMap.set(activePlayer.id, key.toLowerCase())">

                                    </span>

                                </div>

                            </div>

                        </div>

                        <div class="healing-container" *ngIf="(availableMitigation[jobs[activePlayer.type]] | abilityFilter: 'c').length !== 0">

                            <p class="mb-2 mt-3">Healing</p>

                            <div class="icon-container">

                                <div *ngFor="let key of availableMitigation[jobs[activePlayer.type]] | abilityFilter: 'c'" class="ability-icon-container">

                                    <span [matTooltip]="abilities[key.toLowerCase()].desc" [matTooltipClass]="'ability-tooltip'">

                                        <img [src]="getIcon(abilities[key.toLowerCase()].path)" class="ability-icon mat-elevation-z6"
                                            [ngClass]="{'ability-unused': analysis.mitigationTableMap.get(activePlayer.id).get(key.toLowerCase()) === undefined,
                                            'ability-active': activeSkillMap.get(activePlayer.id) === key.toLowerCase()}"
                                            (click)="activeSkillMap.set(activePlayer.id, key.toLowerCase())">

                                    </span>

                                </div>

                            </div>

                        </div>
                    </div>

                    <div class="usage-container col">

                        <mat-list *ngIf="analysis.mitigationTableMap.get(activePlayer.id).get(activeSkillMap.get(activePlayer.id)) as events">

                            <mat-list-item *ngFor="let event of events">
                                {{event.ability.name}} {{events.length}}
                            </mat-list-item>
                        </mat-list>

                    </div>
                </div>

            </mat-card-content>

        </mat-card>

        <mat-card>

            <mat-card-header>

                <mat-card-title class="p-0 m-0">
                    Event Log
                </mat-card-title>

            </mat-card-header>

            <hr class="my-1 mt-2">

            <mat-card-content class="event-container">

                <div *ngFor="let event of analysis.damageTakenEvents">
                    ({{toFightTime(analysis.fight.start_time, event.calculatedTimestamp)}}) {{event.lethal}} {{event.ability.name}}
                </div>

            </mat-card-content>

        </mat-card>
    </div>

</div>